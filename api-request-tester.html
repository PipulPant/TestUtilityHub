<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Request Tester - QA Test Utility Hub</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="utility-page">
<header>
  <i class="fas fa-bars hamburger" onclick="toggleSidebar()"></i>
  <h1><i class="fas fa-plug"></i> API Request Tester</h1>
  <a href="index.html" class="home-icon"><i class="fas fa-home"></i></a>
</header>
<div class="sidebar" id="sidebar"></div>
<div class="content">
  <div class="container">
    <h2>Test API Requests</h2>
    <form id="apiRequestForm">
      <label for="requestMethod">HTTP Method:</label>
      <select id="requestMethod" required>
        <option value="GET">GET</option>
        <option value="POST">POST</option>
        <option value="PUT">PUT</option>
        <option value="DELETE">DELETE</option>
        <option value="PATCH">PATCH</option>
      </select>
      <label for="requestUrl">Request URL:</label>
      <input type="url" id="requestUrl" placeholder="e.g., https://api.example.com/data" required>
      <label for="requestHeaders">Headers (JSON format):</label>
      <textarea id="requestHeaders" placeholder='e.g., {"Authorization": "Bearer token", "Content-Type": "application/json"}' rows="4"></textarea>
      <label for="requestBody">Body (for POST/PUT/PATCH requests):</label>
      <textarea id="requestBody" placeholder='e.g., {"key": "value"}' rows="6"></textarea>
      <button type="button" onclick="performApiRequest()">
        <i class="fas fa-paper-plane"></i> SEND REQUEST
      </button>
    </form>
    <div class="result" id="apiResult" style="display: none;">
      <div id="responseStatus"></div>
      <div id="responseHeaders"></div>
      <div id="responseBody"></div>
      <button class="copy-btn secondary" onclick="copyResponse()">
        <i class="fas fa-copy"></i> Copy Response
      </button>
    </div>
  </div>
</div>
<script src="common.js"></script>
<script>
  let lastResponse = '';
  async function performApiRequest() {
    const method = document.getElementById("requestMethod").value;
    const url = document.getElementById("requestUrl").value;
    const headersInput = document.getElementById("requestHeaders").value;
    const bodyInput = document.getElementById("requestBody").value;
    const resultDiv = document.getElementById("apiResult");
    const statusDiv = document.getElementById("responseStatus");
    const headersDiv = document.getElementById("responseHeaders");
    const bodyDiv = document.getElementById("responseBody");
    resultDiv.style.display = 'none';
    resultDiv.innerHTML = '<div class="spinner"></div>';
    let headers = {};
    let body = null;
    try {
      headers = headersInput ? JSON.parse(headersInput) : {};
    } catch (error) {
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = `<p class="error">Invalid JSON format in headers: ${error.message}</p>`;
      return;
    }
    try {
      body = bodyInput ? JSON.parse(bodyInput) : null;
    } catch (error) {
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = `<p class="error">Invalid JSON format in body: ${error.message}</p>`;
      return;
    }
    const options = {
      method,
      headers: {
        'Content-Type': 'application/json',
        ...headers
      },
    };
    if ((method === "POST" || method === "PUT" || method === "PATCH") && body) {
      options.body = JSON.stringify(body);
    }
    try {
      const startTime = performance.now();
      const response = await fetch(url, options);
      const endTime = performance.now();
      const responseTime = (endTime - startTime).toFixed(2);
      let responseData;
      const contentType = response.headers.get("content-type");
      if (contentType && contentType.includes("application/json")) {
        responseData = await response.json();
      } else {
        responseData = await response.text();
      }
      const statusClass = response.ok ? 'success' : 'error';
      statusDiv.innerHTML = `
        <p class="${statusClass}">
          <strong>Status:</strong> ${response.status} ${response.statusText} | 
          <strong>Time:</strong> ${responseTime}ms
        </p>
      `;
      const headersArray = [];
      response.headers.forEach((value, key) => {
        headersArray.push(`${key}: ${value}`);
      });
      headersDiv.innerHTML = `
        <p><strong>Response Headers:</strong></p>
        <div class="code-output">${headersArray.join('\n')}</div>
      `;
      bodyDiv.innerHTML = `
        <p><strong>Response Body:</strong></p>
        <div class="code-output">${typeof responseData === 'string' ? responseData : JSON.stringify(responseData, null, 2)}</div>
      `;
      lastResponse = typeof responseData === 'string' ? responseData : JSON.stringify(responseData, null, 2);
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = `
        <div id="responseStatus"></div>
        <div id="responseHeaders"></div>
        <div id="responseBody"></div>
        <button class="copy-btn secondary" onclick="copyResponse()">
          <i class="fas fa-copy"></i> Copy Response
        </button>
      `;
      document.getElementById("responseStatus").innerHTML = statusDiv.innerHTML;
      document.getElementById("responseHeaders").innerHTML = headersDiv.innerHTML;
      document.getElementById("responseBody").innerHTML = bodyDiv.innerHTML;
    } catch (error) {
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = `
        <p class="error">Request failed: ${error.message}</p>
        <p class="warning">Note: CORS restrictions may prevent requests to external APIs. Use a browser extension or test from the same origin.</p>
      `;
    }
  }
  function copyResponse() {
    if (lastResponse) {
      copyToClipboard(lastResponse, event.target.closest('button'));
    }
  }
</script>
</body>
</html>
